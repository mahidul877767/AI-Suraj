<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMNI-LINK // NEURAL INTERFACE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Source+Code+Pro&display=swap');
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; color: #00f2ff; }
        
        /* VIDEO BACKGROUND */
        #video-container { position: absolute; inset: 0; z-index: 0; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); filter: brightness(0.4) contrast(1.4) saturate(0.5); }

        /* DATA STREAMS (FALLING CODE) */
        #data-stream-left, #data-stream-right {
            position: absolute; top: 0; width: 120px; height: 100%;
            z-index: 5; font-family: 'Source Code Pro', monospace;
            font-size: 10px; color: rgba(0, 242, 255, 0.4);
            overflow: hidden; white-space: nowrap; pointer-events: none;
        }
        #data-stream-left { left: 10px; }
        #data-stream-right { right: 10px; text-align: right; }

        /* UI HUD */
        #ui-layer { position: absolute; inset: 0; z-index: 20; pointer-events: none; }
        
        .panel { 
            position: absolute; background: rgba(0, 15, 25, 0.7); 
            border: 1px solid rgba(0, 242, 255, 0.3); backdrop-filter: blur(10px);
            padding: 15px; box-shadow: inset 0 0 15px rgba(0, 242, 255, 0.1);
        }

        #hud-header { top: 20px; left: 50%; transform: translateX(-50%); width: 80%; text-align: center; border-bottom: 3px solid #00f2ff; }
        #stats-panel { bottom: 20px; right: 20px; font-size: 11px; }
        
        .glitch { font-weight: 900; letter-spacing: 5px; text-transform: uppercase; color: #fff; text-shadow: 0 0 10px #00f2ff; }

        /* START BUTTON (THE FIX) */
        #overlay {
            position: fixed; inset: 0; background: #000; z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        #start-btn {
            padding: 20px 40px; background: none; border: 2px solid #00f2ff;
            color: #00f2ff; font-family: 'Orbitron'; font-size: 18px; cursor: pointer;
            transition: 0.3s; box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
        }
        #start-btn:hover { background: #00f2ff; color: #000; }
        
        canvas { position: absolute; inset: 0; z-index: 10; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 class="glitch">NEURAL NEXUS v4.0</h1>
        <p id="status-msg">System Offline. Biometric Authorization Required.</p>
        <button id="start-btn">START SYSTEM BOOT</button>
    </div>

    <div id="data-stream-left"></div>
    <div id="data-stream-right"></div>

    <div id="video-container"><video id="input-video" playsinline></video></div>
    
    <div id="ui-layer">
        <div id="hud-header" class="panel">
            <div class="glitch" id="mode-id">SCANNING...</div>
            <div style="font-size: 10px; margin-top: 5px; opacity: 0.7;">HAND_TRACKING: ACTIVE | LATENCY: <span id="lat">12ms</span></div>
        </div>

        <div id="stats-panel" class="panel">
            [MODE]: <span id="m-val">AUTO</span><br>
            [DILATION]: <span id="d-val">1.0x</span><br>
            [FPS]: <span id="fps">--</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

    <script>
        const state = { detected: false, mode: 'IDLE', timeScale: 1.0, handPos: new THREE.Vector3() };
        
        // 1. DATA STREAM LOGIC (THE "FURNITURE")
        function createStream(id) {
            const el = document.getElementById(id);
            setInterval(() => {
                const line = Math.random().toString(16).substring(2, 15) + " " + Math.random().toString(16).substring(2, 10);
                const div = document.createElement('div');
                div.innerText = line;
                el.prepend(div);
                if(el.children.length > 50) el.removeChild(el.lastChild);
            }, 100);
        }
        createStream('data-stream-left');
        createStream('data-stream-right');

        // 2. THREE.JS SCENE
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 70;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const composer = new THREE.EffectComposer(renderer);
        composer.addPass(new THREE.RenderPass(scene, camera));
        composer.addPass(new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.6, 0.4, 0.85));

        // 3. PARTICLES
        const count = 5500;
        const geometry = new THREE.BufferGeometry();
        const posArr = new Float32Array(count * 3);
        const colArr = new Float32Array(count * 3);
        const base = [];

        for(let i=0; i<count; i++) {
            const i3 = i * 3;
            const phi = Math.acos(1 - 2*i/count), theta = Math.PI * (1 + Math.sqrt(5)) * i;
            base.push(32*Math.cos(theta)*Math.sin(phi), 32*Math.sin(theta)*Math.sin(phi), 32*Math.cos(phi));
            posArr[i3] = base[i3]; posArr[i3+1] = base[i3+1]; posArr[i3+2] = base[i3+2];
        }
        geometry.setAttribute('position', new THREE.BufferAttribute(posArr, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colArr, 3));
        const particles = new THREE.Points(geometry, new THREE.PointsMaterial({ size: 1.4, vertexColors: true, transparent: true, blending: THREE.AdditiveBlending }));
        scene.add(particles);

        // 4. ANIMATION ENGINE
        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            const dt = clock.getDelta() * state.timeScale;
            const time = clock.getElapsedTime();
            
            document.getElementById('fps').innerText = Math.round(1/(dt/state.timeScale || 0.01));
            document.getElementById('d-val').innerText = state.timeScale.toFixed(1) + 'x';

            const p = geometry.attributes.position.array;
            const c = geometry.attributes.color.array;

            for(let i=0; i<count; i++) {
                const i3 = i * 3;
                let tx = base[i3] + (state.detected ? state.handPos.x : 0);
                let ty = base[i3+1] + (state.detected ? state.handPos.y : 0);
                let tz = base[i3+2];
                let ease = 0.07 * state.timeScale;

                if(state.mode === 'SINGULARITY') {
                    tx = state.handPos.x; ty = state.handPos.y; ease = 0.15;
                }

                p[i3] += (tx - p[i3]) * ease;
                p[i3+1] += (ty - p[i3+1]) * ease;
                p[i3+2] += (tz - p[i3+2]) * ease;

                const col = new THREE.Color().setHSL(0.5 + Math.sin(time*0.5)*0.1, 0.8, 0.5);
                c[i3] = col.r; c[i3+1] = col.g; c[i3+2] = col.b;
            }
            geometry.attributes.position.needsUpdate = true;
            geometry.attributes.color.needsUpdate = true;
            composer.render();
        }

        // 5. CAMERA START (TRIGGERED BY USER)
        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.6});
        hands.onResults((results) => {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                state.detected = true;
                const lm = results.multiHandLandmarks[0];
                state.timeScale = 1 + (0.5 - lm[9].y) * 2;
                state.handPos.lerp(new THREE.Vector3((0.5 - lm[9].x)*160, (0.5 - lm[9].y)*110, 0), 0.2);
                
                const f = [8,12,16,20].filter(i => lm[i].y < lm[i-2].y).length;
                state.mode = (f === 0) ? 'SINGULARITY' : 'NEURAL_LINK';
                document.getElementById('mode-id').innerText = state.mode;
            } else {
                state.detected = false;
                document.getElementById('mode-id').innerText = 'SEARCHING...';
            }
        });

        const video = document.getElementById('input-video');
        const cameraUtils = new Camera(video, {
            onFrame: async () => { await hands.send({image: video}); },
            width: 1280, height: 720
        });

        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('status-msg').innerText = "Initiating Camera Link...";
            cameraUtils.start().then(() => {
                document.getElementById('overlay').style.display = 'none';
                animate();
            }).catch(e => {
                alert("Camera Access Denied. Check browser settings.");
            });
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
                                                                                           </html>
