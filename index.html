<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OMNI-OS v8.0 // NEURAL MASTERPIECE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Share+Tech+Mono&display=swap');
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; color: #00f2ff; }
        
        /* ভিডিও ব্যাকগ্রাউন্ড */
        #video-container { position: absolute; inset: 0; z-index: 0; background: #000; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); opacity: 0; filter: brightness(0.4) contrast(1.2); transition: opacity 1s; }

        /* ডাটা স্ট্রিম (বামে ও ডানে) */
        .stream { position: absolute; top: 0; width: 15%; height: 100%; z-index: 5; font-family: 'Share Tech Mono'; font-size: 9px; color: rgba(0, 242, 255, 0.25); overflow: hidden; pointer-events: none; }
        #stream-l { left: 10px; } #stream-r { right: 10px; text-align: right; }

        /* HUD সিস্টেম */
        .hud-panel { position: absolute; background: rgba(0, 10, 20, 0.8); border: 1px solid rgba(0, 242, 255, 0.4); backdrop-filter: blur(10px); padding: 12px; box-shadow: 0 0 20px rgba(0, 242, 255, 0.1); z-index: 20; }
        #header { top: 20px; left: 50%; transform: translateX(-50%); width: 75%; text-align: center; border-bottom: 3px solid #00f2ff; }
        #status-bar { bottom: 20px; left: 20px; width: 250px; font-size: 11px; height: 100px; overflow: hidden; font-family: 'Share Tech Mono'; }

        /* বুট স্ক্রিন (এটিই ক্যামেরা অন করার চাবিকাঠি) */
        #boot-screen { position: fixed; inset: 0; background: radial-gradient(circle, #001a1a 0%, #000 100%); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #start-btn { padding: 25px 50px; background: transparent; border: 2px solid #00f2ff; color: #00f2ff; font-family: 'Orbitron'; font-size: 20px; cursor: pointer; text-transform: uppercase; letter-spacing: 5px; box-shadow: 0 0 30px rgba(0, 242, 255, 0.4); transition: 0.3s; }
        #start-btn:active { transform: scale(0.9); background: #00f2ff; color: #000; }
        
        canvas { position: absolute; inset: 0; z-index: 10; pointer-events: none; }
    </style>
</head>
<body>

    <div id="boot-screen">
        <h1 style="letter-spacing: 12px; text-shadow: 0 0 15px #00f2ff;">OMNI-OS</h1>
        <p style="font-size: 10px; opacity: 0.5; margin-bottom: 40px;">v8.0.2 // QUANTUM NEURAL ENGINE</p>
        <button id="start-btn">INITIALIZE SYSTEM</button>
        <div id="error-msg" style="color: #ff3333; margin-top: 20px; font-size: 12px;"></div>
    </div>

    <div id="stream-l" class="stream"></div>
    <div id="stream-r" class="stream"></div>

    <div id="video-container"><video id="webcam" muted playsinline></video></div>
    
    <div id="ui-layer">
        <div id="header" class="hud-panel">
            <div style="font-weight: 900; letter-spacing: 5px;" id="mode-id">SYNCHRONIZING...</div>
            <div style="font-size: 10px; opacity: 0.6; margin-top: 5px;">CORE_TEMP: 32°C | NEURAL_LINK: <span id="link-stat">OFFLINE</span></div>
        </div>
        <div id="status-bar" class="hud-panel">
            <div style="border-bottom: 1px solid rgba(0,242,255,0.2); margin-bottom: 5px;">SYSTEM_LOGS:</div>
            <div id="log-content"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        const state = { active: false, detected: false, handPos: new THREE.Vector3(), mode: 'IDLE' };

        // ১. লগ সিস্টেম
        function addLog(m) {
            const log = document.getElementById('log-content');
            log.innerHTML = `> ${m}<br>` + log.innerHTML;
            if(log.children.length > 6) log.lastChild.remove();
        }

        // ২. ডাটা স্ট্রিম এনিমেশন
        setInterval(() => {
            if(!state.active) return;
            const l = document.getElementById('stream-l'), r = document.getElementById('stream-r');
            const gen = () => Math.random().toString(16).toUpperCase().slice(2,12);
            l.innerHTML = `<div>${gen()}</div>` + l.innerHTML;
            r.innerHTML = `<div>${gen()}</div>` + r.innerHTML;
            if(l.children.length > 50) { l.lastChild.remove(); r.lastChild.remove(); }
        }, 100);

        // ৩. THREE.JS গ্রাফিক্স (কণা এবং লাইন)
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 70;
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const count = 6000;
        const geo = new THREE.BufferGeometry();
        const posArr = new Float32Array(count * 3);
        const base = [];
        for(let i=0; i<count; i++) {
            const i3 = i * 3;
            const phi = Math.acos(1 - 2*i/count), theta = Math.PI * (1 + Math.sqrt(5)) * i;
            base.push(35*Math.cos(theta)*Math.sin(phi), 35*Math.sin(theta)*Math.sin(phi), 35*Math.cos(phi));
            posArr[i3] = base[i3]; posArr[i3+1] = base[i3+1]; posArr[i3+2] = base[i3+2];
        }
        geo.setAttribute('position', new THREE.BufferAttribute(posArr, 3));
        const mat = new THREE.PointsMaterial({ size: 1.1, color: 0x00f2ff, transparent: true, blending: THREE.AdditiveBlending });
        const points = new THREE.Points(geo, mat);
        scene.add(points);

        function animate() {
            requestAnimationFrame(animate);
            const p = geo.attributes.position.array;
            for(let i=0; i<count; i++) {
                const i3 = i * 3;
                let tx = base[i3] + (state.detected ? state.handPos.x : 0);
                let ty = base[i3+1] + (state.detected ? state.handPos.y : 0);
                let ease = state.mode === 'SINGULARITY' ? 0.25 : 0.08;
                if(state.mode === 'SINGULARITY') { tx = state.handPos.x; ty = state.handPos.y; }
                p[i3] += (tx - p[i3]) * ease;
                p[i3+1] += (ty - p[i3+1]) * ease;
            }
            geo.attributes.position.needsUpdate = true;
            renderer.render(scene, camera);
        }

        // ৪. বুট সিকোয়েন্স এবং ক্যামেরা (সবচেয়ে গুরুত্বপূর্ণ অংশ)
        const video = document.getElementById('webcam');
        const startBtn = document.getElementById('start-btn');
        const errorMsg = document.getElementById('error-msg');

        async function bootSystem() {
            try {
                startBtn.innerText = "AUTHORIZING...";
                addLog("Requesting biometric access...");

                // ক্যামেরা পারমিশন ফোর্স করা
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user", width: { ideal: 1280 }, height: { ideal: 720 } } 
                });
                
                video.srcObject = stream;
                await video.play();
                video.style.opacity = "1";
                addLog("Camera Feed: OK");

                // MediaPipe হ্যান্ড ট্র্যাকিং
                const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
                hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.6});
                
                hands.onResults((res) => {
                    if (res.multiHandLandmarks && res.multiHandLandmarks.length > 0) {
                        state.detected = true;
                        const lm = res.multiHandLandmarks[0];
                        state.handPos.lerp(new THREE.Vector3((0.5 - lm[9].x)*160, (0.5 - lm[9].y)*110, 0), 0.2);
                        
                        // জেসচার শনাক্তকরণ (মুঠি বা চিমটি)
                        const dist = Math.sqrt(Math.pow(lm[4].x-lm[8].x,2) + Math.pow(lm[4].y-lm[8].y,2));
                        state.mode = dist < 0.04 ? 'SINGULARITY' : 'NEURAL_LINK';
                        
                        document.getElementById('mode-id').innerText = state.mode;
                        document.getElementById('link-stat').innerText = 'ENCRYPTED';
                    } else {
                        state.detected = false;
                        document.getElementById('mode-id').innerText = 'SCANNING...';
                        document.getElementById('link-stat').innerText = 'SEARCHING';
                    }
                });

                const cameraWorker = new Camera(video, {
                    onFrame: async () => { await hands.send({image: video}); },
                    width: 1280, height: 720
                });
                
                await cameraWorker.start();
                state.active = true;
                document.getElementById('boot-screen').style.display = 'none';
                addLog("System Online. Interface Ready.");
                animate();

            } catch (err) {
                console.error(err);
                errorMsg.innerText = "ERROR: " + err.message + " (Check Camera Settings)";
                startBtn.innerText = "RETRY BOOT";
                addLog("CRITICAL: Permission Denied.");
            }
        }

        startBtn.addEventListener('click', bootSystem);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
